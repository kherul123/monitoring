<!DOCTYPE html>
<html lang="id">

<head>
	<meta charset="UTF-8">
	<title>Dashboard User</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<style>
		body {
			margin: 0;
			font-family: 'Segoe UI', sans-serif;
			background: #f5f5f5;
		}

		.wrapper {
			display: flex;
			min-height: 100vh;
		}

		.sidebar {
			width: 220px;
			background: rgb(0, 0, 0);
			color: white;
			padding: 20px 10px;
			box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}

		.sidebar h2 {
			text-align: center;
			color: white;
			font-size: 20px;
			margin-bottom: 20px;
		}

		.sidebar a {
			display: block;
			color: white;
			text-decoration: none;
			margin: 15px 0;
			padding: 8px 10px;
			border-radius: 5px;
		}

		.sidebar a:hover {
			background-color: #1b4f72;
		}

		.content {
			flex-grow: 1;
			padding: 20px;
		}

		h1, h2 {
			color: #333;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			margin-bottom: 40px;
			background: white;
			box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
		}

		th, td {
			border: 1px solid #ddd;
			padding: 12px;
			text-align: center;
		}

		th {
			background-color: #2e86de;
			color: white;
		}

		canvas {
			background: white;
			padding: 10px;
			border-radius: 10px;
			box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
		}

		.button-cetak {
			background-color: #28a745;
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 8px;
			cursor: pointer;
			margin-bottom: 20px;
			text-decoration: none;
			display: inline-block;
		}

		.hamburger {
			display: none;
			position: absolute;
			top: 10px;
			left: 10px;
			font-size: 26px;
			cursor: pointer;
			color: #000;
			z-index: 1001;
		}

		@media (max-width: 768px) {
			.wrapper {
				flex-direction: column;
			}

			.sidebar {
				position: fixed;
				top: 0;
				left: 0;
				height: 100%;
				transform: translateX(-100%);
				z-index: 1000;
			}

			.sidebar.show {
				transform: translateX(0);
			}

			.hamburger {
				display: block;
			}

			.content {
				padding: 70px 20px 20px;
			}
		}
	</style>
</head>

<body>
	<div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>

	<div class="wrapper">
		<div class="sidebar" id="sidebar">
			<h2>User Panel</h2>
			<a href="dashboard_user.php">üìä Dashboard</a>
			<a href="logout.php" onclick="return confirmLogout();">üö™ Logout</a>
		</div>

		<div class="content">
			<h1>Selamat Datang, <?= htmlspecialchars($_SESSION['username']) ?>!</h1>

			<a class="button-cetak" href="cetak_pdf.php" target="_blank">üñ®Ô∏è Cetak PDF Tabel</a>
			<a class="button-cetak" href="#" onclick="exportPDF()">üìÑ Cetak PDF Grafik</a>

			<h2>üìã Data Sensor</h2>
			<table>
				<thead>
					<tr>
						<th>ID</th>
						<th>Nama Bahan</th>
						<th>Suhu (¬∞C)</th>
						<th>Kelembapan (%RH)</th>
						<th>Berat Basah (kg)</th>
						<th>Berat Kering (kg)</th>
						<th>Tanggal dan Waktu</th>
					</tr>
				</thead>
				<tbody>
					<?php mysqli_data_seek($queryTabel, 0);
					while ($row = mysqli_fetch_assoc($queryTabel)) : ?>
						<tr>
							<td><?= $row['id'] ?></td>
							<td><?= $row['Nama_bahan'] ?></td>
							<td><?= $row['suhu'] ?></td>
							<td><?= $row['kelembaban'] ?></td>
							<td><?= $row['berat_basah'] ?></td>
							<td><?= $row['berat_kering'] ?></td>
							<td><?= $row['waktu'] ?></td>
						</tr>
					<?php endwhile; ?>
				</tbody>
			</table>

			<h2>üìä Grafik Berat Rempah</h2>
			<canvas id="grafikBerat" width="1000" height="400"></canvas>
		</div>
	</div>

	<script>
		function toggleSidebar() {
			document.getElementById("sidebar").classList.toggle("show");
		}

		function confirmLogout() {
			return confirm("Anda yakin ingin logout?");
		}

		const ctx = document.getElementById('grafikBerat').getContext('2d');
		const chart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: <?= json_encode($labels) ?>,
				datasets: [{
					label: 'Berat (kg)',
					data: <?= json_encode($berat) ?>,
					borderColor: 'blue',
					backgroundColor: 'rgba(62, 18, 106, 0.1)',
					borderWidth: 2,
					tension: 0.4,
					pointBackgroundColor: 'blue',
					fill: true
				}]
			},
			options: {
				responsive: true,
				plugins: {
					title: {
						display: true,
						text: 'Grafik Berat Rempah'
					}
				},
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});

		async function exportPDF() {
			const {
				jsPDF
			} = window.jspdf;
			const pdf = new jsPDF();

			const canvasElement = document.getElementById("grafikBerat");
			const canvasImage = await html2canvas(canvasElement);
			const imageData = canvasImage.toDataURL("image/png");

			const imgProps = pdf.getImageProperties(imageData);
			const pdfWidth = pdf.internal.pageSize.getWidth();
			const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

			pdf.addImage(imageData, 'PNG', 10, 10, pdfWidth - 20, pdfHeight);
			pdf.save("grafik_berat_rempah.pdf");
		}
	</script>
</body>

</html>
